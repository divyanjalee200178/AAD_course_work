<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Question Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<div class="container mt-5">
    <h2 class="mb-4">Manage Exam Questions</h2>

    <div class="mb-3">
        <label for="questionId">Question ID:</label>
        <input type="text" id="questionId" class="form-control mb-2" required>

        <label for="content" class="form-label">Content :</label>
        <input type="text" id="content" class="form-control mb-2" placeholder="Question Content" required>

        <label for="option1" class="form-label">Option 1:</label>
        <input type="text" id="option1" class="form-control mb-2" placeholder="Option 1" required>

        <label for="option2" class="form-label">Option 2:</label>
        <input type="text" id="option2" class="form-control mb-2" placeholder="Option 2" required>

        <label for="option3" class="form-label">Option 3:</label>
        <input type="text" id="option3" class="form-control mb-2" placeholder="Option 3" required>

        <label for="option4" class="form-label">Option 4:</label>
        <input type="text" id="option4" class="form-control mb-2" placeholder="Option 4" required>

        <label for="mcqNumber" class="form-label">MCQ Number:</label>
        <input type="number" id="mcqNumber" class="form-control mb-2" placeholder="MCQ Number" required>

        <label for="answer" class="form-label">Answer:</label>
        <input type="text" id="answer" class="form-control mb-2" placeholder="Correct Answer" required>

        <label for="examId" class="form-label">Exam ID:</label>
        <input type="number" id="examId" class="form-control mb-2" placeholder="Exam ID" required>

        <label for="userId" class="form-label">User ID:</label>
        <input type="number" id="userId" class="form-control mb-2" placeholder="User ID" required>

        <button class="btn btn-primary" onclick="handleSubmitData()">Add Question</button>

        <button class="btn btn-warning" onclick="handleUpdate()">Update Question</button>
        <button class="btn btn-danger" onclick="clearForm()">Clear Form</button>
    </div>

    <h3>Search Questions</h3>
    <input type="number" id="searchMcqNumber" class="form-control mb-2" placeholder="Enter MCQ Number">
    <button class="btn btn-info" onclick="fetchQuestionsByMcq()">Search</button>

    <table class="table table-bordered mt-3">
        <thead>
        <tr>
            <th>MCQ Number</th>
            <th>Content</th>
            <th>Options</th>
            <th>Answer</th>
            <th>Exam ID</th>
            <th>User ID</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="questionTableBody"></tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        fetchQuestionsByMcq();
    });


    function fetchQuestionsByMcq() {
        const mcqNumber = $('#searchMcqNumber').val();
        if (!mcqNumber) {
            alert('Please enter an MCQ Number to search.');
            return;
        }

        $.ajax({
            url: `http://localhost:8080/api/v1/questions/mcq/${mcqNumber}`,
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                const tableBody = $('#questionTableBody');
                tableBody.empty();

                if (data.length === 0) {
                    alert('No questions found for the given MCQ Number.');
                    return;
                }

                data.forEach(question => {
                    tableBody.append(`
                    <tr>
                        <td>${question.mcqNumber}</td>
                        <td>${question.content}</td>
                        <td>${question.option1}, ${question.option2}, ${question.option3}, ${question.option4}</td>
                        <td>${question.answer}</td>
                        <td>${question.examId}</td>
                        <td>${question.userId}</td>
                        <td>
                            <button class="btn btn-warning" onclick="editQuestion(${question.id})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteQuestion(${question.id})">Delete</button>
                        </td>
                    </tr>
                `);
                });
            },
            error: function () {
                alert('Error fetching questions. Please try again.');
            }
        });
    }
    function handleSubmitData() {
        const questionData = {
            content: $("#content").val(),
            option1: $("#option1").val(),
            option2: $("#option2").val(),
            option3: $("#option3").val(),
            option4: $("#option4").val(),
            mcqNumber: parseInt($("#mcqNumber").val()),
            answer: $("#answer").val(),
            examId: parseInt($("#examId").val()),
            userId: parseInt($("#userId").val())
        };


        if (!questionData.content || !questionData.option1 || !questionData.option2 || !questionData.option3 || !questionData.option4 || !questionData.answer) {
            alert("Please fill in all fields!");
            return;
        }

        console.log("Sending question data:", JSON.stringify(questionData));

        $.ajax({
            url: "http://localhost:8080/api/v1/questions/post",
            method: "POST",
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(questionData),
            success: function (response) {
                alert("Question added successfully!");
                console.log("Success:", response);
                fetchQuestionsByMcq();
                clearForm();
            },
            error: function (xhr, status, error) {
                try {
                    let response = JSON.parse(xhr.responseText);
                    alert("Error: " + response.message);
                    console.log("Error:", response);
                } catch (e) {
                    alert("Unexpected error occurred!");
                    console.log("Parsing error:", e);
                }
            }
        });
    }

    function handleUpdate() {
        const questionId = $('#questionId').val();
        if (!questionId) {
            alert('Please select a question to update.');
            return;
        }

        const question = getQuestionData();
        if (!question) return;

        $.ajax({
            url: `http://localhost:8080/api/v1/questions/${questionId}`,
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(question),
            success: function () {
                alert('Question updated successfully');
                clearForm();
                fetchQuestionsByMcq();
            },
            error: function () {
                alert('Error updating question. Please try again.');
            }
        });
    }


    function deleteQuestion(questionId) {
        if (!confirm('Are you sure you want to delete this question?')) return;

        $.ajax({
            url: `http://localhost:8080/api/v1/questions/${questionId}`,
            method: 'DELETE',
            success: function () {
                alert('Question deleted successfully');
                fetchQuestionsByMcq();
            },
            error: function () {
                alert('Error deleting question. Please try again.');
            }
        });
    }

    function editQuestion(questionId) {
        $.ajax({
            url: `http://localhost:8080/api/v1/questions/${questionId}`,
            method: 'GET',
            success: function (data) {
                $('#questionId').val(data.id);
                $('#content').val(data.content);
                $('#option1').val(data.option1);
                $('#option2').val(data.option2);
                $('#option3').val(data.option3);
                $('#option4').val(data.option4);
                $('#mcqNumber').val(data.mcqNumber);
                $('#answer').val(data.answer);
                $('#examId').val(data.examId);
                $('#userId').val(data.userId);
            },
            error: function () {
                alert('Error fetching question details.');
            }
        });
    }

    function clearForm() {
        $('#questionId, #content, #option1, #option2, #option3, #option4, #mcqNumber, #answer, #examId, #userId').val('');
    }

    function getQuestionData() {
        return {
            id: $('#questionId').val() || null,
            content: $('#content').val(),
            option1: $('#option1').val(),
            option2: $('#option2').val(),
            option3: $('#option3').val(),
            option4: $('#option4').val(),
            mcqNumber: parseInt($('#mcqNumber').val()),
            answer: $('#answer').val(),
            examId: parseInt($('#examId').val()),
            userId: parseInt($('#userId').val())
        };
    }
</script>

</body>
</html>
