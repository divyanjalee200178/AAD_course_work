<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Portal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
        }
        .header {
            background-color: maroon;
            color: white;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        .container {
            border: 1px solid #ddd;
            padding: 25px;
            max-width: 800px;
            margin: 0 auto;
        }
        .question {
            margin-bottom: 25px;
            padding: 15px;
        }
        .options label {
            display: block;
            margin: 10px 0;
        }
        button {
            background-color: maroon;
            color: white;
            padding: 12px 25px;
            border: none;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        .result {
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
<div class="header">
    <h1>Exam Paper</h1>
</div>

<div class="container" id="examPaper"></div>

<button onclick="submitAnswers()">Submit Answers</button>
<div id="result" class="result"></div>

<script>
    let questionsData = []; // Store questions
    let answersData = {}; // Store selected answers

    // Fetch questions from API
    async function loadQuestions() {
        try {
            const response = await fetch('http://localhost:8080/api/v1/question/get');
            if (!response.ok) throw new Error('Failed to load questions');

            questionsData = await response.json();
            questionsData.forEach(q => {
                answersData[q.qid] = [];  // Initialize answer storage (array for multiple selections)
            });

            renderQuestions();

        } catch (error) {
            console.error('Error:', error);
            document.getElementById('examPaper').innerHTML =
                '<p>Error loading questions. Please refresh the page.</p>';
        }
    }

    // Render questions to the page
    function renderQuestions() {
        const questionsHTML = questionsData.map(q => `
        <div class="question">
            <p><strong>${q.mcqNumber}. ${q.content}</strong></p>
            <div class="options">
                ${['option1', 'option2', 'option3', 'option4'].map((opt, i) => `
                    <label>
                        <input type="checkbox"
                            name="question_${q.qid}"
                            value="${i + 1}"
                            onchange="saveAnswer(${q.qid}, ${i + 1}, this)"
                            ${answersData[q.qid].includes(i + 1) ? 'checked' : ''}>
                        ${String.fromCharCode(97 + i)}) ${q[opt]}
                    </label><br>
                `).join('')}
            </div>
        </div>
        <hr>
    `).join('');

        document.getElementById('examPaper').innerHTML = `
        <h3>Answer All Questions</h3>
        ${questionsHTML}
    `;
    }

    // Store selected answer
    function saveAnswer(qid, answer, checkbox) {
        if (checkbox.checked) {
            // Add the selected answer
            answersData[qid].push(answer);
        } else {
            // Remove the answer if unchecked
            answersData[qid] = answersData[qid].filter(ans => ans !== answer);
        }
        console.log("Saved Answers:", answersData);
    }

    async function submitAnswers() {
        try {
            const response = await fetch('http://localhost:8080/api/v1/question/submit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(answersData)
            });

            if (!response.ok) throw new Error('Failed to submit answers');

            const score = await response.json();
            document.getElementById('result').innerText = `Your Score: ${score}`;
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('result').innerText = 'Error calculating score. Try again.';
        }
    }



    // Initialize when page loads
    window.addEventListener('DOMContentLoaded', loadQuestions);
</script>
</body>
</html>
